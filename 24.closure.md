24. 클로저

# 렉시컬 스코프 = 정적 스코프
자바스크립트는 함수를 어디서 정의했는지에 따라 상위 스코프를 결정한다.

`렉시컬 환경의 '외부 렉시컬 환경에 대한 참조'에 저장할 참조값, 즉 상위 스코프에 대한 참조는 함수 정의가 평가되는 시점에 함수가 정의된 환경(위치)에 결정된다 = 렉시컬 스코프`


# 함수 객체의 내부 슬롯[[Environment]]
함수는 자신의 내부슬롯 [[Environment]]에 자신이 정의된 환경, 즉 상위 스코프의 참조를 저장한다. 함수가 호출되는 환경과 상관 없다.

함수가 호출되면 함수 내부로 제어권이 이동한다. 
이후 함수 코드 평가가 시작된다.

  1 함수 실행 컨텍스트 생성
  2 함수 렉시컬 환경 생성
    2.1 함수 환경 레코드 생성
    2.2 외부 렉시컬 환경에 대한 참조 할당
    2.3 this 바인딩

함수 객체의 내부 슬롯 [[Environment]]에 저장된 렉시컬 환경의 참조가 할당된다.


# 클로저와 렉시컬 환경
클로저 : 자신을 포함하고 있는 외부 함수보다 중첩 함수가 더 오래 유지되는 경우, 외부 함수 밖에서 중첩 함수를 호출하더라도 외부 함수의 지역 변수에 접근할 수 있는 함수를 지칭한다.

![외부 함수가 소멸해도 반환된 중첩함수는 외부 함수의 변수를 참조할 수 있다](https://poiemaweb.com/assets/fs-images/24-5.png)


일반적으로 클로저(closure)는,
자신을 포함하고 있는 외부 함수보다 중첩 함수가 더 오래 유지되는 경우, 외부 함수 밖에서 중첩 함수가 호출되더라도 외부 함수의 식별자에 접근할 수 있는 함수를 말한다.

클로저는 자유 변수와 묶여 있는 함수다.
상위 스코프 변수를 자유 변수라 부른다.


# 클로저의 활용
클로저는 상태를 안전하게 유지하기 위해 사용한다.
은닉하다가도 상태가 변경되면 최신 상태를 유지한다.

`카운터 상태는 반드시 이벤트 핸들러 increase만이 변경할 수 있다.`

클로조는 상태 변경이나 가변 데이터를 피하고 부수 효과를 최대한 억제하여 오류를 피하고 프로그램의 안정성을 높이기 위해 적극적으로 사용된다.
