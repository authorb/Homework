23. 실행 컨텍스트

# 소스 타입의 코드

  ## 전역 코드 
  전역에 존재하는 코드. 전역에 정의된 함수, 클래스 등의 내부 코드는 불포함. 

  전역 코드는 전역 변수 관리 위해 최상위 스코프인 전역 스코프 생성한다.

  var 키워드로 선언된 전역 변수, 함수 선언문으로 정의된 전역 함수를 전역 객체의 프로퍼티와 메소드로 바인딩하고 참조하기 위해 전역 객체와 연결되어야 한다. 이를 위해 전역 코드 평가되면 전역 실행 컨텍스트 생성.


  ## 함수 코드 
  함수 내부에 존재하는 소스 코드. 함수 내부에 중첩된 함수, 클래스 등의 내부 코드는 불포함.

  함수 코드는 지역 스코프를 생성하고 지역 변수와 매개 변수를 관리한다. 

  생성한 지역 스코프를 전역 스코프에서 시작하는 스코프 체인의 일원으로 연결한다. 이를 위해 함수 코드가 평가되면 함수 실행 컨텍스트가 생성.

  ## eval 코드 
  생략.

  ## 모듈 코드
  모듈 내부에 존재하는 소스 코드. 코듈 내부의 함수, 클래스 등의 내부 코드는 불포함. 

  모듈 코드는 모듈 별로 독자적인 스코프 생성. 이를 위해 모듈 코드 평가되면 모듈 실행 컨텍스트 생성.


# 소스 코드의 평가와 실행
![소스 코드의 평가와 실행] (https://poiemaweb.com/assets/fs-images/23-2.png)


# 실행 컨텍스트의 역할
  1. 전역 코드 평가
  전역 코드 실행하기 앞서 전역 코드 평가 준비.
  변수 선언문과 함수 선언문 먼저 실행.
  그 결과 생성된 전역 변수와 전역 함수가 실행 컨텍스트가 관리하는 전역 스코프에 등록됨.
  var 키워드로 선언된 전역 변수와 함수 선언문으로 정의된 전역 함수는 전역 객체의 프로퍼티와 메소드가 된다.

  2. 전역 코드 실행
  코드 평가 끝나면 전역 코드 순차적으로 실행.
  전역 변수에 값 할당되고 함수 호출.
  실행 순서 잠시 바뀌면서 함수 몸체내부로 진입.

  3. 함수 코드 평가
  함수 코드 평가하면서 함수 코드 실행 준비.
  매개변수와 지역 변수 선언문 먼저 실행.
  매개 변수와 지역 변수가 실행컨텍스트가 관리하는 지역 스코프에 등록된다.
  함수 내부에서 지역 변수처럼 사용할 수 있는 arguments 객체도 생성되어 지역 스코프에 등록.

  4. 함수 코드 실행
  함수 코드 평가 끝나면 함수 코드 순차적 실행.
  매개 변수와 지역 변수에 값 할당되고 console.log 메소드 호출.
  console은 전역 객체의 프로퍼티
  log는 프로토타입 체인 프로퍼티 검색

  `코드 실행되려면 스코프, 식별자, 코드 실행 순서 등 관리 필요.`


실행 컨텍스트는 소스 코드 실행하기 위해 필요한 환경을 제공하고 코드의 실행 결과를 실제로 관리하는 영역. 식별자(변수, 함수, 클래스 등) 등록하고 관리하는 스코프와 코드 실행 순서를 구현하는 내부 메커니즘으로 실행되고 관리된다.


# 실행 컨텐스트 스택(콜 스택)
실행 컨텍스트 스택은 실행 순서를 관리.

`실행 컨텍스트 스택의 최상위에 존재하는 실행 컨텍스트는 언제나 현재 실행중인 실행 컨텍스트(running execution context).`


# 동기식 처리 모델과 비동기식 처리 모델
자바스크립트 엔진은 실행 컨텍스트 스택 하나를 갖는다. 
자바스크립트가 싱글 스레드로 동작한다는 것을 의미.

하나의 처리가 종료되어야 다음 처리를 실행하는 동기식 처리모델.


# 렉시컬 환경(Lexical Environment)
렉시컬 환경은 `식별자와 식별자에 바인딩된 값, 상위 스코프에 대한 참조를 기록하는 환경으로 실행 컨텍스트를 구성하는 컴포넌트`이다.

렉시컬 환경은 스코프를 구분하여 식별자를 등록하고 관리하는 저정소 역할을 하는 렉시컬 스코프의 실체이다.

실행 컨텍스트는 렉시컬 환경 컴포넌트와 변수 환경 컴포넌트로 구성.

렉시컬 환경 컴포넌트는 환경 레코드와 외부 렉시컬 환경 참조로 구성.

`환경 레코드 : 스코프에 포함된 식별자를 등록하고 식별자에 바인딩된 값을 관리하는 저장소.`

`외부 렉시컬 환경 참조 : 해당 실행 컨텍스트 생성한 소스 코드를 포함한 상위 코드의 렉시컬 환경을 가리킨다.`


# 실행 컨텍스트의 생성과 식별자 검색 과정
. 전역 코드 평가

1 전역 실행 컨텍스트 생성

2 전역 렉시컬 환경 생성 : 렉시컬 환경 컴포넌트, 변수 환경 컴포넌트 바인딩

  2.1 전역 환경 레코드 생성 : 전역 스코프, 표준 빌트인 객체, 전역 빌트인 프로퍼티와 메소드 제공

    2.1.1 객체 환경 레코드 생성 : 전역 코드 평가 과정에서 var 키워드로 선언한 전역 변수와 함수 선언문으로 정의된 전역 함수는 전역 환경 레코드의 전역 환경 레코드에 연결된 바인딩오브젝트를 통해 전역 객체의 프로퍼티와 메소드가 된다.

    2.1.2 선언적 환경 레코드 생성 : let, const 키워드로 선언한 전역변수를 등록하고 관리.

  2.2 외부 렉시컬 환경에 대한 참조 할당 : 평가 중인 코드를 포함한 상위 스코프 가리킨다.

  2.3 this 바인딩 : 전역 환경 레코드의 [[GlobalThisValue]] 내부 슬롯에 this가 바인딩된다.


# 전역 코드 실행
식별자 결정 : 선언된 식별자인지, 선언된 식별자라면 어느 스코프의 식별자를 참조하면 되는지 결정.
